# Генератор изображений FLUX с GGUF квантованием

Генерация высококачественных изображений с использованием FLUX.1-dev с GGUF квантованием для эффективного использования памяти GPU.

## Системные требования

- **GPU**: 12GB VRAM (протестировано)
- **RAM**: 32GB
- **CUDA**: Совместимая версия (протестировано с cu128)

## Почему FLUX GGUF?

Протестированы Stable Diffusion 1, 1.5 и SDXL, но результаты не удовлетворили. Переключился на FLUX для лучшего качества, но он оказался слишком тяжелым. GGUF квантованная версия обеспечивает лучший баланс качества и производительности.

## Установка

### 1. Установка зависимостей

```bash
pip install -r requirements.txt
```

**Примечание**: Версия PyTorch CUDA должна соответствовать вашей GPU. Протестировано с `cu128`, но может отличаться в зависимости от системы.

### 2. Загрузка модели FLUX

Загрузите GGUF модель с [HuggingFace](https://huggingface.co/city96/FLUX.1-dev-gguf/tree/main):

- Рекомендуется: `flux1-dev-Q4_0.gguf` (6.79 GB)
- Поместите в директорию `models/`

### 3. Загрузка весов LoRA

Загрузите LoRA с [HuggingFace Flux_Loras](https://huggingface.co/idevst/Flux_Loras/tree/main):

- Рекомендуется: `aidmaImageUpgrader-FLUX-V0.1.safetensors` (19.3 MB)
- Поместите в директорию `models/`

### 4. Структура директорий

```
HappyColor_Automation/
├── models/
│   ├── flux1-dev-Q4_0.gguf
│   └── aidmaImageUpgrader-FLUX-V0.1.safetensors
├── outputs/
├── generator_flux.py
├── gradio_flux_app.py
└── config.yaml
```

## Использование

### Командная строка

```bash
python generator_flux.py
```

### Веб-интерфейс (Gradio)

```bash
python gradio_flux_app.py
```

Доступ по адресу `http://localhost:7860`

## Производительность

- **Время генерации**: 60-80 секунд на изображение (1024×1024, 20 шагов)
- **Модель**: FLUX.1-dev Q4_0 квантование
- **Оптимизация**: Можно улучшить с помощью:
  - Лучшей GPU (больше VRAM)
  - Моделей более высокого качества (FLUX.2, FLUX Kontext или другие продвинутые diffusers модели)
  - Более высоких уровней квантования (Q5, Q6, Q8) для лучшего качества

## Возможные улучшения

- **Улучшение промптов с помощью LLM**: Интеграция языковой модели для автоматического улучшения и расширения пользовательских промптов перед генерацией
- **Апскейлер изображений**: Добавление апскейлера в конце пайплайна для увеличения разрешения сгенерированных изображений (например, Real-ESRGAN, ESRGAN)

## Функции

- GGUF квантование для снижения использования памяти
- Поддержка LoRA для улучшения качества изображений
- Несколько соотношений сторон (1:1, 3:4, 4:3, 16:9, 9:16)
- Настраиваемое количество шагов (1-50)
- Контроль seed для воспроизводимости
- Автосохранение сгенерированных изображений

## Конфигурация

Отредактируйте `config.yaml` для настройки:
- Путей к моделям
- Параметров генерации по умолчанию
- Соотношений сторон
- Настроек вывода
